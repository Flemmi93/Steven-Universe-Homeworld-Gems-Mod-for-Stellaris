namespace = pink_situation

#the rebel diamond can be any diamond. currently only pink's path is build
#Blue, Yellow and White will have unique paths that are not them replacing pink
#A mood event should trigger once a decade, halfway to the midgame pink should want a colony
#initializing the mood System.
country_event = {
	id = pink_situation.1
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		set_global_flag = f93_mood_system_enabled
		random_owned_leader = {
			limit = { has_leader_flag = pink_diamond_flag }
			save_global_event_target_as = gem_rebel_diamond@root
		}
		begin_event_chain = {
			event_chain = pink_event_chain
			target = event_target:gem_rebel_diamond@root
		}
		#The Counter and the Variable always have to be in sync, as it is impossible to track the
		# counter otherwise.
		set_variable = { which = f93_pinks_mood_variable value = 0 }
		change_pink_mood = { ADD = 80 }
		set_variable = { which = f93_pinks_mood_variable value = 80 } #just to be sure.
		set_variable = { which = f93_pinks_stable_variable value = 0 }
		change_stable_mood = { ADD = 40 }
		set_variable = { which = f93_pinks_stable_variable value = 40 }
	}
}

#This Event Block can increase and descrease her mood.

# Lowers Pink mood score ba a set amount during a set time interval, no lower than 20
# Her mood wanders over time to a Stable Point
country_event = {
	id = pink_situation.11
	is_triggered_only = yes
	hide_window = yes
	event_chain = pink_event_chain
	trigger = {
		has_global_flag = f93_mood_system_enabled
	}
	immediate = {
		if = {
			limit = {
				check_variable = { which = f93_pinks_mood_variable value > f93_pinks_stable_variable }
				check_variable = { which = f93_pinks_mood_variable value > 0 }
			}
			change_pink_mood = { ADD = -1 }
		}
		if = {
			limit = {
				check_variable = { which = f93_pinks_mood_variable value < f93_pinks_stable_variable }
				check_variable = { which = f93_pinks_mood_variable value < 100 }
			}
			change_pink_mood = { ADD = 1 }
		}
	}

}

#Starts Pink's Tantrum Situation and Event every time her mood goes below 30
country_event = {
	id = pink_situation.2
	is_triggered_only = yes
	hide_window = yes
	event_chain = pink_event_chain
	trigger = {
		has_event_chain = pink_event_chain
		check_variable = { which = f93_pinks_mood_variable value < 30 }
	}
	immediate = {
		random_owned_leader = {
			limit = { has_leader_flag = pink_diamond_flag }
			save_event_target_as = gem_rebel_diamond@root
		}
		start_situation = { type = pink_situation target = event_target:gem_rebel_diamond@root }
	}
}
#First stage events
# Initial Events when the situation starts
#Pink plays a prank on a diamond, they get distracted for 1 year
country_event = {
	id = pink_situation.21
	title = pink_situation.21.name
	desc = pink_situation.21.desc
	picture = "GFX_evt_gem_homeworld"
	event_chain = pink_event_chain
	is_triggered_only = yes
	immediate = {
		random_owned_leader = {
			limit = { has_trait = trait_ruler_diamond NOT = { has_trait = trait_pink_court } }
			save_event_target_as = target_leader
		}
	}
	option = {
		name = pink_situation.21.a
		event_target:target_leader = {
			add_experience = -200
		}
		add_modifier = {
			modifier = pm_pink_tantrum_1
			days = 360
			mult = 0.1
		}
	}
}
#Pink misstreats her Attendance Gems and increases maintenance of rulers
country_event = {
	id = pink_situation.22
	title = pink_situation.22.name
	desc = pink_situation.22.desc
	picture = "GFX_evt_gem_homeworld"
	event_chain = pink_event_chain
	is_triggered_only = yes
	trigger = {
		has_country_flag = f93_pink_mood_3
	}
	immediate = {
		random_owned_leader = {
			limit = { has_trait = trait_ruler_diamond NOT = { has_trait = trait_pink_court } }
			save_event_target_as = target_leader
		}
	}
	option = {
		name = pink_situation.22.a
		add_modifier = {
			modifier = pm_pink_tantrum_3
			days = 360
			mult = 0.01
		}
	}
}

#Second stage events

#Third stage events

#Finisher events

######################################
#Events that Progress her Mood Story.#
######################################
#Creating her small attendance Gems
country_event = {
	id = pink_situation.3
	title = "pink_situation.3.name"
	desc = "pink_situation.3.desc"
	picture = "GFX_evt_gem_homeworld"
	show_sound = offcolors_01 #replace with appropriate music-clip
	is_triggered_only = yes
	event_chain = pink_event_chain
	immediate = {
		set_country_flag = f93_pink_mood_3
	}
	option = {
		name = OK
	}
}
#Creating Spinel
country_event = {
	id = pink_situation.4
	title = "pink_situation.4.name"
	desc = "pink_situation.4.desc"
	picture = "GFX_evt_gem_homeworld"
	show_sound = offcolors_01 #replace with appropriate music-clip
	is_triggered_only = yes
	event_chain = pink_event_chain
	immediate = {
		set_country_flag = f93_pink_mood_4
		enable_special_project = {
			name = f93_pink_spinel_project
		}
	}
	option = {
		name = OK
	}
}
#This Event enables the Garden Project.
country_event = {
	id = pink_situation.5
	title = "pink_situation.5.name"
	desc = "pink_situation.5.desc"
	picture = "GFX_evt_gem_homeworld"
	show_sound = offcolors_01 #replace with appropriate music-clip
	is_triggered_only = yes
	event_chain = pink_event_chain
	immediate = {
		set_country_flag = f93_pink_mood_5
		enable_special_project = {
			name = f93_pink_garden_project
		}
	}
	option = {
		name = OK
	}
}
# The first choice during the garden project
country_event = {
	id = pink_situation.51
	title = "pink_situation.51.name"
	desc = "pink_situation.51.desc"
	picture = "GFX_evt_gem_homeworld"
	show_sound = offcolors_01 #replace with appropriate music-clip
	
	is_triggered_only = yes
	event_chain = pink_event_chain

	immediate = {
		export_X_month_resource_income_to_variable = {
			resource = energy
			variable = year_energy
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = minerals
			variable = year_minerals
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = consumer_goods
			variable = year_consumer_goods
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = alloys
			variable = year_alloys
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = food
			variable = year_food
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = exotic_gases
			variable = year_exotic_gases
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = volatile_motes
			variable = year_volatile_motes
			month = 12
		}
		export_X_month_resource_income_to_variable = {
			resource = rare_crystals
			variable = year_rare_crystals
			month = 12
		}
	}
	#Decision to do nothing for now.
	option = {
		name = "pink_situation.51.0"
	}
	#Small extra investment
	option = {
		name = "pink_situation.51.a"
		allow = {
			has_resource = {
				type = energy amount > year_energy
				type = minerals amount > year_minerals
				type = alloys amount > year_alloys
			}
		}
		add_monthly_resource_mult = { resource = energy value = -0.05 mult = year_energy }
		add_monthly_resource_mult = { resource = minerals value = -0.05 mult = year_minerals }
		add_monthly_resource_mult = { resource = alloys value = -0.05 mult = year_alloys }
	}
	#big extra investment option
	option = {
		name = "pink_situation.51.b"
		allow = {
			has_resource = {
				type = energy amount > year_energy
				type = minerals amount > year_minerals
				type = alloys amount > year_alloys
				type = rare_crystals amount > year_rare_crystals
			}
			has_resource = {
				type = rare_crystals amount > 500
			}
		}
		add_monthly_resource_mult = { resource = energy value = -0.125 mult = year_energy }
		add_monthly_resource_mult = { resource = minerals value = -0.125 mult = year_minerals }
		add_monthly_resource_mult = { resource = alloys value = -0.125 mult = year_alloys }
		add_monthly_resource_mult = { resource = rare_crystals value = -0.085 min = 500 mult = year_rare_crystals }
	}
}

#Pink Wants a Colony
#Enables the option to give her a colony if said colony has the f93_valid_pink_colony@root flag
country_event = {
	id = pink_situation.9
	title = "pink_situation.9.name"
	desc = "pink_situation.9.desc"
	picture = "GFX_evt_gem_homeworld"
	show_sound = offcolors_01 #replace with appropriate music-clip
	
	is_triggered_only = yes
	event_chain = pink_event_chain

	immediate = {
		set_country_flag = pink_wants_a_colony
	}
	option = {
		name = pink_situation.9.a
		custom_tooltip = pink_situation.9.a.desc
	}
}