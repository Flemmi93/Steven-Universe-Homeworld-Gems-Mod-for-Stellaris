namespace = gem_pop

country_event = {
	id = gem_pop.1
	is_triggered_only = yes
	hide_window = yes
	fire_only_once = yes
	immediate = {
		capital_scope = {
			add_modifier = {
				modifier = pm_gem_white_court
			}
			add_modifier = {
				modifier = pm_gem_yellow_court
			}
			add_modifier = {
				modifier = pm_gem_blue_court
			}
			add_modifier = {
				modifier = pm_gem_pink_court
			}
			update_diamond_court_modifier = yes
		}
	}
}

# an amount of pops has grown as is assigned to a diamond as their liege
# This = Planet scope
# From = Country
# FromFrom = Pop group
# local_pop_amount = variable of how much was grown
planet_event = {
	id = gem_pop.2
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		FromFrom = { is_geoloid = yes }
		NOT = { has_planet_flag = gem_pop2_just_happened }
	}
	immediate = {
		#in case the variable is not set for some reason
		if = {
			limit = { NOT = { is_variable_set = gem_pops_made } } 
			set_variable = { which = gem_pops_made value = 0 }
		}
		#only once per pop creation batch
		set_timed_planet_flag = {
			flag = gem_pop2_just_happened
			days = 1
		}
		#Count the pops made on this world.
		change_variable = { which = gem_pops_made value = local_pop_amount }
	}
}

country_event = {
	id = gem_pop.3
	is_triggered_only = yes
	hide_window = yes
	trigger = { is_geo_empire = yes }
	immediate = {
		every_owned_planet = {
			update_diamond_court_modifier = yes
		}


		####this is a bugfix until i find the cause
		every_owned_planet = {
			limit = {
				is_capital = no
				calc_true_if = {
					amount > 1
					has_modifier = pm_gem_white_court
					has_modifier = pm_gem_yellow_court
					has_modifier = pm_gem_blue_court
					has_modifier = pm_gem_pink_court
				}
			}
			remove_modifier = pm_gem_white_court
			remove_modifier = pm_gem_yellow_court
			remove_modifier = pm_gem_blue_court
			remove_modifier = pm_gem_pink_court
		}
	}
}