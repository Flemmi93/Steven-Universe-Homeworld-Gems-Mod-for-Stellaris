#From = Country scope (new owner)
#This = Planet scope
namespace = gem_diamond_choice        

#planet court Distribution event
planet_event = { #replaces the grand court
    id = gem_diamond_choice.0001
	picture = GFX_evt_gem_homeworld
	title = pm_grand_court_1
	desc = pm_grand_court_1_desc
	is_triggered_only = yes
	trigger = {
		owner = { is_diamond_empire = yes }
		OR = {
			this = { NOT = { has_modifier = pm_grand_court_1 } }
			this = { NOT = { has_modifier = pm_grand_court_2 } }
		}
	}
	option = {
		trigger = {
			owner = { has_country_flag = era_two_flag }
		}
		name = OK
		this = { add_modifier = { modifier = pm_grand_court_2 } }
		hidden_effect = { this = { set_planet_flag = grand_court } }
	}	
	option = {
		trigger = {
			OR = {
				owner = { has_country_flag = era_one_flag }
				owner = { has_country_flag = era_three_flag }
			}
		}
		name = OK
		this = { add_modifier = { modifier = pm_grand_court_1 } }
		hidden_effect = { this = { set_planet_flag = grand_court } }
	}
	
	after = {
		hidden_effect = {
			this = {
				remove_modifier = pm_grand_court_1
				remove_modifier = pm_grand_court_2
				remove_planet_flag = grand_court
				remove_modifier = "pm_gem_white_court"
				remove_modifier = "pm_gem_yellow_court"
				remove_modifier = "pm_gem_blue_court"
				remove_modifier = "pm_gem_pink_court"
				remove_modifier = "pm_gem_white_court2"
				remove_modifier = "pm_gem_yellow_court2"
				remove_modifier = "pm_gem_blue_court2"
				remove_modifier = "pm_gem_pink_court2"
				remove_planet_flag = white_court_flag
				remove_planet_flag = yellow_court_flag
				remove_planet_flag = blue_court_flag
				remove_planet_flag = pink_court_flag
			}
		}
	}
}
	
planet_event = { #triggers the step counter
    id = gem_diamond_choice.1002
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_planet_flag = planet_had_court_before }
	}
	immediate = {
		owner = { country_event = { id = gem_off_colors.0009} }
	}
}
planet_event = {
	id = gem_diamond_choice.1010
	
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = {
			OR = {
				has_civic = civic_tetrarchy
				has_civic = civic_triarchy
			}
		}
		NOR = {
			has_planet_flag = white_court_flag		
			has_planet_flag = yellow_court_flag
			has_planet_flag = blue_court_flag
			has_planet_flag = pink_court_flag
			has_planet_flag = grand_court
			has_planet_flag = gem_planet_pink_gone
		}
	}
	immediate = { planet_event = { id = gem_diamond_choice.1001 } }
}
#The Event that regulates what diamond rules any given planet.
#all 4 Diamonds are represented here but each diamonds section is made up of several choices
#1. option is always the main option of the choice
#2. option is for when the diamond is dead, this is made so the fail text and the tooltip change.
#3. this option shows when the diamond is the last one alive.
#option 2 and 3 dont do much currently since diamonds cant die at this time.
	
planet_event = { #What Diamond shall rule over this Planet
    id = gem_diamond_choice.1001
	title = gem_diamond_choice.name
	desc = {
		text = gem_diamond_choice.desc
		trigger = {
			NOR = {
				has_planet_flag = gem_planet_earth # generated by this mod
				has_planet_flag = planet_earth # regular earth.
			}
			OR = {
				owner = { has_country_flag = era_three_flag }
				NOT = { owner = { has_country_flag = gem_sol_system } }
			}
		}
	}
	desc = {
		text = gem_diamond_choice.desc1
		text = gem_diamond_choice.desc2
		text = gem_diamond_choice.desc3
		text = gem_diamond_choice.desc4
		text = gem_diamond_choice.desc5
		trigger = {
			NOR = {
				has_planet_flag = gem_planet_earth # generated by this mod
				has_planet_flag = planet_earth # regular earth.
			}
			owner = { has_country_flag = gem_sol_system }
		}
	}
	desc = {
		text = gem_diamond_choice.desc.earth
		trigger = {
			OR = {
				has_planet_flag = gem_planet_earth # generated by this mod
				has_planet_flag = planet_earth # regular earth.
			}
			NOT = { owner = { has_country_flag = era_three_flag } }
		}
	}
	picture =  GFX_evt_gem_diamond_choice

    is_triggered_only = yes
	
	trigger = {
		AND = {
			is_diamond_empire = yes
			NOR = {
			has_planet_flag = white_court_flag		
			has_planet_flag = yellow_court_flag
			has_planet_flag = blue_court_flag
			has_planet_flag = pink_court_flag
			has_planet_flag = gem_planet_pink_gone
			}
		}
	}
	immediate = {
		set_planet_flag = planet_had_court_before
		planet_event = { id = gem_diamond_choice.1002 days = 1} # triggers step cpunter
		owner = {
			set_country_flag = pink_is_ready4
			set_country_flag = pink_is_ready5
		}
	}
	
###################
## White Diamond ##
###################
	option = { #main option for white
		trigger = {
			AND = {
				owner = { has_country_flag = white_alive }
				NAND = {
					has_planet_flag = gem_planet_earth
					owner = { has_country_flag = era_one_flag }
				}
			}
		}
		name = "gem_diamond_choice.a"
		custom_tooltip = "gem_diamond_choice.a.desc"
		hidden_effect = {
			set_planet_flag = white_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = white_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_white_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_white_court2" } }
		}
	}
	option = { # option for white when she is dead
		trigger = { owner = { NOT = { has_country_flag = white_alive } } }
		allow = { owner = { has_country_flag = white_alive } }
		name = "gem_diamond_choice.a"
		custom_tooltip = "gem_diamond_choice.a.dead"
	}
	option = { #option for white when she is the last one left
		trigger = {
			AND = {
				owner = { # all other diamonds are dead
					NOT = { has_country_flag = blue_alive }
					NOT = { has_country_flag = yellow_alive }
					NOT = { has_country_flag = pink_alive }
				}
			}
		}
		name = "gem_diamond_choice.a"
		custom_tooltip = "gem_diamond_choice.e.dead"
		hidden_effect = {
			set_planet_flag = white_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = white_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_white_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_white_court2" } }
		}
	
	}
####################
## Yellow Diamond ##
####################	
	option = { # main option for yellow
		trigger = {
			AND = {
				owner = { has_country_flag = yellow_alive }
				NAND = {
					has_planet_flag = gem_planet_earth
					owner = { has_country_flag = era_one_flag }
				}
			}
		}
		name = "gem_diamond_choice.b"
		custom_tooltip = "gem_diamond_choice.b.desc"
		hidden_effect = {
			set_planet_flag = yellow_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = yellow_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_yellow_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_yellow_court2" } }
		}
	}
	option = { # option for when yellow is dead.
		trigger = { owner = { NOT = { has_country_flag = yellow_alive } } }
		allow = { owner = { has_country_flag = yellow_alive } }
		name = "gem_diamond_choice.b"
		custom_tooltip = "gem_diamond_choice.b.dead"
	}
	option = { # blue is the last one alive
		trigger = {
			AND = {
				owner = {
					NOT = { has_country_flag = white_alive }
					NOT = { has_country_flag = blue_alive }
					NOT = { has_country_flag = pink_alive }
				}
			}
		}
		name = gem_diamond_choice.b
		custom_tooltip = gem_diamond_choice.e.dead
		hidden_effect = {
			set_planet_flag = yellow_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = yellow_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_yellow_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_yellow_court2" } }
		}
	
	}
##################
## Blue Diamond ##
##################	
	option = { # main option for blue
		trigger = {
			AND = {
				owner = { has_country_flag = blue_alive }
				NAND = {
					has_planet_flag = gem_planet_earth
					owner = { has_country_flag = era_one_flag }
				}
			}
		}
		name = "gem_diamond_choice.c"
		custom_tooltip = "gem_diamond_choice.c.desc"
		hidden_effect = {
			set_planet_flag = blue_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = blue_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_blue_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_blue_court2" } }
		}
	}
	option = { # option when blue is dead
		trigger = { owner = { NOT = { has_country_flag = blue_alive } } }
		allow = { owner = { has_country_flag = blue_alive } }
		name = "gem_diamond_choice.c"
		custom_tooltip = "gem_diamond_choice.c.dead"
	}
	option = { # option when blue is last one left
		trigger = {
			AND = {
				owner = {
					NOT = { has_country_flag = white_alive }
					NOT = { has_country_flag = yellow_alive }
					NOT = { has_country_flag = pink_alive }
				}
			}
		}
		name = "gem_diamond_choice.c"
		custom_tooltip = "gem_diamond_choice.e.dead"
		hidden_effect = {
			set_planet_flag = blue_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = blue_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_blue_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_blue_court2" } }
		}
	
	}
##################
## Pink Diamond ##
##################
	option = { # main option for pink
		trigger = {
			AND = {
				owner = { has_country_flag = pink_alive }
				owner = { has_country_flag = era_three_flag }
			}
		}
		name = "gem_diamond_choice.d"
		custom_tooltip = "gem_diamond_choice.d.desc"
		hidden_effect = {
			set_planet_flag = pink_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = pink_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_pink_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_pink_court2" } }
		}
	}
	option = { # option for pink to take the earth for the first time. any earth
		trigger = {
			AND = {
				OR = {
					has_planet_flag = gem_planet_earth # generated by this mod
					has_planet_flag = planet_earth # regular earth.
				}
				owner = { NOT = { has_country_flag = 1000_year_war } }
				owner = { NOT = { has_country_flag = era_three_flag } }
				owner = { has_country_flag = pink_alive }
			}
		}
		name = "gem_diamond_choice.d.earth"
		custom_tooltip = "gem_diamond_choice.d.desc"
		hidden_effect = {
			set_planet_flag = pink_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = pink_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_pink_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_pink_court2" } }
			add_modifier = { modifier = "pm_gem_human_experiement" }
			remove_planet_flag = gem_planet_earth
			set_planet_flag = gem_planet_earth_owned_by_pink_pre_era_2
			set_planet_flag = gem_planet_earth
			owner = { set_country_flag = pink_got_earth }
			owner = { remove_country_flag = pink_wants_earth }
		}
	}
	option = { # option when pink is dead.
		trigger = { owner = { NOT = { has_country_flag = pink_alive } } }
		allow = { owner = { has_country_flag = pink_alive } }
		name = "gem_diamond_choice.d"
		custom_tooltip = "gem_diamond_choice.d.dead"
	}
	option = { # option for era one, its always grayed out and has random names.
		trigger = {
			NOR = {
				has_planet_flag = planet_earth
				has_planet_flag = gem_planet_earth
			}
			owner = { has_country_flag = era_one_flag }
		}
		allow = {
			owner = {
				has_country_flag = pink_is_ready1 #flavour only
				has_country_flag = pink_is_ready2 
				has_country_flag = pink_is_ready3 
				NOT = {	has_country_flag = pink_is_ready5 }
				NOT = {	has_country_flag = pink_is_ready4 }
			}
		}
		name = gem_diamond_choice.d
		custom_tooltip = "gem_diamond_choice.d.unready"
	}
	option = { # option when pink is last one left.
		trigger = {
			AND = {
				owner = {
					NOT = { has_country_flag = white_alive }
					NOT = { has_country_flag = yellow_alive }
					NOT = { has_country_flag = blue_alive }
				}
			}
		}
		name = "gem_diamond_choice.d"
		custom_tooltip = "gem_diamond_choice.e.dead"
		hidden_effect = {
			set_planet_flag = pink_court_flag
			if = {
				limit = { owner = { NOT = { has_country_flag = pink_ascended_flag } } }
				add_modifier = { modifier = "pm_gem_pink_court" }
			}
			else = { add_modifier = { modifier = "pm_gem_pink_court2" } }
		}
	
	}
}

country_event = { #update to the ascended court
    id = gem_diamond_choice.1003
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		every_owned_planet = {
			limit = {
				has_modifier = pm_gem_white_court
				owner = { has_country_flag = white_ascended_flag }
			}
			remove_modifier = pm_gem_white_court
			add_modifier = { modifier = pm_gem_white_court2}
		}
		every_owned_planet = {
			limit = {
				has_modifier = pm_gem_yellow_court
				owner = { has_country_flag = yellow_ascended_flag }
			}
			remove_modifier = pm_gem_yellow_court
			add_modifier = { modifier = pm_gem_yellow_court2}
		}
		every_owned_planet = {
			limit = {
				has_modifier = pm_gem_blue_court
				owner = { has_country_flag = blue_ascended_flag }
			}
			remove_modifier = pm_gem_blue_court
			add_modifier = { modifier = pm_gem_blue_court2}
		}
		every_owned_planet = {
			limit = {
				has_modifier = pm_gem_pink_court
				owner = { has_country_flag = pink_ascended_flag }
			}
			remove_modifier = pm_gem_pink_court
			add_modifier = { modifier = pm_gem_pink_court2}
		}
	}
}